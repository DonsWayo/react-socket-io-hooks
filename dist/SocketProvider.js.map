{"version":3,"file":"SocketProvider.js","sources":["../src/SocketProvider.js"],"sourcesContent":["import React, { useState, useReducer, useEffect, useContext } from 'react';\nimport io from 'socket.io-client';\n\nconst SocketContext = React.createContext(null);\n\nexport const SocketProvider = ({ uri, children, reducer, initialState = {} }) => {\n  const [socket, setSocket] = useState({});\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  useEffect(() => {\n    const newSocket = io.connect(uri);\n    const emit = newSocket.io.emit.bind(newSocket.io);\n    newSocket.io.emit = function (...args) {\n      const [eventType, event] = args;\n      if (eventType === 'packet') {\n        const { data = [] } = event;\n        const [eventName, payload] = data;\n        const action = { type: eventName, payload };\n        dispatch(action);\n      }\n\n      return emit(...args);\n    };\n\n    setSocket(newSocket);\n\n    return () => {\n      setSocket(null);\n      return newSocket.disconnect();\n    };\n  }, []);\n\n  return (\n    <SocketContext.Provider value={{ socket, state, dispatch }}>\n      {children}\n    </SocketContext.Provider>\n  );\n};\n\nexport const useSocket = () => {\n  const { socket } = useContext(SocketContext);\n  return socket;\n};\n\nexport const useSocketState = () => {\n  const { state } = useContext(SocketContext);\n  return state;\n};\n\nexport const useSocketSelector = selector => {\n  const state = useSocketState();\n  return selector(state);\n}\n\nexport const useEmit = () => {\n  return socket.emit;\n}\n\nexport const useEmitEvent = eventName => {\n  const socket = useSocket();\n  return data => socket.emit(eventName, data);\n};\n\nexport const useSocketDispatch = () => {\n  const { dispatch } = useContext(SocketContext);\n  return dispatch;\n}\n"],"names":["SocketContext","React","createContext","SocketProvider","uri","children","reducer","initialState","useState","socket","setSocket","useReducer","state","dispatch","useEffect","newSocket","io","connect","emit","bind","args","eventType","event","data","eventName","payload","action","type","disconnect","useSocket","useContext","useSocketState","useSocketSelector","selector","useEmit","useEmitEvent","useSocketDispatch"],"mappings":"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"}